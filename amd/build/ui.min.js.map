{"version":3,"file":"ui.min.js","sources":["../src/ui.js"],"sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle. If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * Commands helper for the Moodle tiny_chemdraw plugin.\n *\n * @module      plugintype_pluginname/ui\n * @copyright   2024 Aniket Kumar <aniketkj9211@gmail.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {get_string as getString} from 'core/str';\nimport Templates from 'core/templates';\nimport Modal from 'core/modal';\nimport Config from 'core/config';\nimport {exception as displayException} from 'core/notification';\n\n\nexport const ChemEmbed = class {\n  editor = null;\n  constructor(editor) {\n    this.editor = editor;\n  }\n\n  loadResource = async(url, type) => {\n    return new Promise((resolve, reject) => {\n      const element = (type === \"script\") ? document.createElement(\"script\") : document.createElement(\"link\");\n      element.onload = resolve;\n      element.onerror = () => reject(new Error(`Failed to load ${type}: ${url}`));\n      if (type === \"stylesheet\") {\n        element.rel = 'stylesheet';\n        element.href = url;\n      } else if (type === \"script\") {\n        element.src = url;}\n      document[type === \"script\" ? 'body' : 'head'].appendChild(element);\n    });\n  };\n\n  initializeChemDoodle = () => {\n    try {\n      ChemDoodle.ELEMENT[\"H\"].jmolColor = \"black\";\n      ChemDoodle.ELEMENT[\"S\"].jmolColor = \"#B9A130\";\n\n      // Main ketcher initialization\n      const sketcher = new ChemDoodle.SketcherCanvas(\"sketcher\", 600, 350, {\n        useServices: false,\n        requireStartingAtom: false,\n      });\n      // Additional initialization for ChemDoodle goes here...\n      sketcher.styles.atoms_displayTerminalCarbonLabels_2D = true;\n      sketcher.styles.atoms_useJMOLColors = true;\n      sketcher.styles.bonds_clearOverlaps_2D = true;\n      sketcher.styles.shapes_color = \"#c10000\";\n      sketcher.repaint();\n      // Preview ketcher initialization\n      const sketcherViewer = new ChemDoodle.ViewerCanvas(\"sketcher-viewer-atto\", 100, 100);\n      sketcherViewer.emptyMessage = \"No data loaded\";\n      sketcherViewer.styles.atoms_displayTerminalCarbonLabels_2D = true;\n      sketcherViewer.styles.atoms_useJMOLColors = true;\n      sketcherViewer.styles.bonds_clearOverlaps_2D = true;\n      sketcher.oldFunc = sketcher.checksOnAction;\n      sketcher.checksOnAction = function (force) {\n        this.oldFunc(force);\n        let mols = sketcher.molecules;\n        let forms = sketcher.shapes;\n        sketcherViewer.loadContent(mols, forms);\n        sketcher.center();\n        for (let i = 0, ii = this.molecules.length; i < ii; i++) {\n          this.molecules[i].check();\n        }\n      };\n    } catch (error) {\n      console.error(\"Error:\", error.message);\n    }\n  };\n\n  init = async() => {\n    try {\n      const modal = await Modal.create({\n        title: getString('sketchtitle'),\n        show: true,\n        removeOnClose: true,\n      });\n      Templates.renderForPromise('tiny_chemdraw/chemTemplate', {})\n        .then(async ({ html, js }) => {\n          Templates.appendNodeContents(modal.getBody(), html, js);\n          const resources = [\n            `${Config.wwwroot}/lib/editor/tiny/plugins/chemdraw/ChemDoodle/install/ChemDoodleWeb.css`,\n            `${Config.wwwroot}/lib/editor/tiny/plugins/chemdraw/ChemDoodle/install/uis/jquery-ui-1.11.4.css`,\n            `${Config.wwwroot}/lib/editor/tiny/plugins/chemdraw/ChemDoodle/install/ChemDoodleWeb.js`,\n            `${Config.wwwroot}/lib/editor/tiny/plugins/chemdraw/ChemDoodle/install/uis/ChemDoodleWeb-uis.js`,\n            `${Config.wwwroot}/lib/editor/tiny/plugins/chemdraw/chem/chem.css`\n          ];\n\n          const types = [\"stylesheet\", \"stylesheet\", \"script\", \"script\", \"stylesheet\"];\n\n          for (let i = 0; i < resources.length; i++) {\n            await loadResource(resources[i], types[i]);\n          }\n\n          // Add this line to fix the model width.\n          window.parent.document.querySelector(\".modal-dialog\").style.maxWidth = '850px';\n\n          // Load and run ChemDoodle functionality\n          loadAndRunChemDoodle();\n        }) \n    } catch (error) {\n      displayException(error);\n    }\n  };\n}\n\nexport const insert = () => {\n  if (window.parent.tinyMCE && window.parent.tinyMCE.activeEditor) {\n    let mol = sketcherViewer.getMolecule();\n    let src = ChemDoodle.io.png.string(sketcherViewer);\n    let molFile = ChemDoodle.writeMOL(mol);\n    let width = document.getElementById('width_input_molstructure').valueAsNumber;\n    let height = document.getElementById('height_input_molstructure').valueAsNumber;\n    var content =\n      '<img src=\"' +\n      src +\n      '\" width=\"' +\n      width +\n      'px\" height=\"' +\n      height +\n      'px\">';\n\n    window.parent.tinyMCE.activeEditor.execCommand(\n      \"mceInsertContent\",\n      0,\n      content\n    );\n    window.parent.tinyMCE.activeEditor.execCommand(\n      \"mceInsertContent\",\n      0,\n      \"<!--\" + molFile + \"-->\"\n    );\n    var modal = window.parent.document.querySelector('.modal');\n    var closeButton = modal.querySelector('.close');\n    closeButton.click();\n  }\n  console.log(\"button Click\");\n};"],"names":["editor","constructor","loadResource","async","url","type","Promise","resolve","reject","element","document","createElement","onload","onerror","Error","rel","href","src","appendChild","initializeChemDoodle","ChemDoodle","ELEMENT","jmolColor","sketcher","SketcherCanvas","useServices","requireStartingAtom","styles","atoms_displayTerminalCarbonLabels_2D","atoms_useJMOLColors","bonds_clearOverlaps_2D","shapes_color","repaint","sketcherViewer","ViewerCanvas","emptyMessage","oldFunc","checksOnAction","force","mols","molecules","forms","shapes","loadContent","center","i","ii","this","length","check","error","console","message","init","modal","Modal","create","title","show","removeOnClose","renderForPromise","then","html","js","appendNodeContents","getBody","resources","Config","wwwroot","types","window","parent","querySelector","style","maxWidth","loadAndRunChemDoodle","tinyMCE","activeEditor","mol","getMolecule","io","png","string","molFile","writeMOL","content","getElementById","valueAsNumber","execCommand","click","log"],"mappings":";;;;;;;sPA8ByB,MACvBA,OAAS,KACTC,YAAYD,aACLA,OAASA,OAGhBE,aAAeC,MAAMC,IAAKC,OACjB,IAAIC,SAAQ,CAACC,QAASC,gBACrBC,QAAoB,WAATJ,KAAqBK,SAASC,cAAc,UAAYD,SAASC,cAAc,QAChGF,QAAQG,OAASL,QACjBE,QAAQI,QAAU,IAAML,OAAO,IAAIM,MAAO,kBAAiBT,SAASD,QACvD,eAATC,MACFI,QAAQM,IAAM,aACdN,QAAQO,KAAOZ,KACG,WAATC,OACTI,QAAQQ,IAAMb,KAChBM,SAAkB,WAATL,KAAoB,OAAS,QAAQa,YAAYT,YAI9DU,qBAAuB,SAEnBC,WAAWC,QAAX,EAAwBC,UAAY,QACpCF,WAAWC,QAAX,EAAwBC,UAAY,gBAG9BC,SAAW,IAAIH,WAAWI,eAAe,WAAY,IAAK,IAAK,CACnEC,aAAa,EACbC,qBAAqB,IAGvBH,SAASI,OAAOC,sCAAuC,EACvDL,SAASI,OAAOE,qBAAsB,EACtCN,SAASI,OAAOG,wBAAyB,EACzCP,SAASI,OAAOI,aAAe,UAC/BR,SAASS,gBAEHC,eAAiB,IAAIb,WAAWc,aAAa,uBAAwB,IAAK,KAChFD,eAAeE,aAAe,iBAC9BF,eAAeN,OAAOC,sCAAuC,EAC7DK,eAAeN,OAAOE,qBAAsB,EAC5CI,eAAeN,OAAOG,wBAAyB,EAC/CP,SAASa,QAAUb,SAASc,eAC5Bd,SAASc,eAAiB,SAAUC,YAC7BF,QAAQE,WACTC,KAAOhB,SAASiB,UAChBC,MAAQlB,SAASmB,OACrBT,eAAeU,YAAYJ,KAAME,OACjClB,SAASqB,aACJ,IAAIC,EAAI,EAAGC,GAAKC,KAAKP,UAAUQ,OAAQH,EAAIC,GAAID,SAC7CL,UAAUK,GAAGI,SAGtB,MAAOC,OACPC,QAAQD,MAAM,SAAUA,MAAME,WAIlCC,KAAOlD,oBAEGmD,YAAcC,eAAMC,OAAO,CAC/BC,OAAO,mBAAU,eACjBC,MAAM,EACNC,eAAe,uBAEPC,iBAAiB,6BAA8B,IACtDC,MAAK1D,MAAAA,WAAO2D,KAAEA,KAAFC,GAAQA,4BACTC,mBAAmBV,MAAMW,UAAWH,KAAMC,UAC9CG,UAAY,CACf,GAAEC,gBAAOC,gFACT,GAAED,gBAAOC,uFACT,GAAED,gBAAOC,+EACT,GAAED,gBAAOC,uFACT,GAAED,gBAAOC,0DAGNC,MAAQ,CAAC,aAAc,aAAc,SAAU,SAAU,kBAE1D,IAAIxB,EAAI,EAAGA,EAAIqB,UAAUlB,OAAQH,UAC9B3C,aAAagE,UAAUrB,GAAIwB,MAAMxB,IAIzCyB,OAAOC,OAAO7D,SAAS8D,cAAc,iBAAiBC,MAAMC,SAAW,QAGvEC,0BAEJ,MAAOzB,mCACUA,0BAKD,QAChBoB,OAAOC,OAAOK,SAAWN,OAAOC,OAAOK,QAAQC,aAAc,KAC3DC,IAAM7C,eAAe8C,cACrB9D,IAAMG,WAAW4D,GAAGC,IAAIC,OAAOjD,gBAC/BkD,QAAU/D,WAAWgE,SAASN,SAG9BO,QACF,aACApE,IACA,YALUP,SAAS4E,eAAe,4BAA4BC,cAO9D,eANW7E,SAAS4E,eAAe,6BAA6BC,cAQhE,OAEFjB,OAAOC,OAAOK,QAAQC,aAAaW,YACjC,mBACA,EACAH,SAEFf,OAAOC,OAAOK,QAAQC,aAAaW,YACjC,mBACA,EACA,UAASL,QAAU,UAETb,OAAOC,OAAO7D,SAAS8D,cAAc,UACzBA,cAAc,UAC1BiB,QAEdtC,QAAQuC,IAAI"}