{"version":3,"file":"ui.min.js","sources":["../src/ui.js"],"sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle. If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * Commands helper for the Moodle tiny_chemdraw plugin.\n *\n * @module      plugintype_pluginname/ui\n * @copyright   2024 Aniket Kumar <aniketkj9211@gmail.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport { get_string as getString } from \"core/str\";\nimport Templates from \"core/templates\";\nimport Modal from \"core/modal\";\nimport Config from \"core/config\";\nimport { exception as displayException } from \"core/notification\";\n\nexport const ChemEmbed = class {\n  editor = null;\n  constructor(editor) {\n    this.editor = editor;\n  }\n\n  loadResource = async (url, type) => {\n    return new Promise((resolve, reject) => {\n      const element =\n        type === \"script\"\n          ? document.createElement(\"script\")\n          : document.createElement(\"link\");\n      element.onload = resolve;\n      element.onerror = () =>\n        reject(new Error(`Failed to load ${type}: ${url}`));\n      if (type === \"stylesheet\") {\n        element.rel = \"stylesheet\";\n        element.href = url;\n      } else if (type === \"script\") {\n        element.src = url;\n      }\n      document[type === \"script\" ? \"body\" : \"head\"].appendChild(element);\n    });\n  };\n\n  initializeChemDoodle = () => {\n    try {\n      ChemDoodle.ELEMENT[\"H\"].jmolColor = \"black\";\n      ChemDoodle.ELEMENT[\"S\"].jmolColor = \"#B9A130\";\n\n      // Main ketcher initialization\n      const sketcher = new ChemDoodle.SketcherCanvas(\"sketcher\", 600, 350, {\n        useServices: false,\n        requireStartingAtom: false,\n      });\n      // Additional initialization for ChemDoodle goes here...\n      sketcher.styles.atoms_displayTerminalCarbonLabels_2D = true;\n      sketcher.styles.atoms_useJMOLColors = true;\n      sketcher.styles.bonds_clearOverlaps_2D = true;\n      sketcher.styles.shapes_color = \"#c10000\";\n      sketcher.repaint();\n      // Preview ketcher initialization\n      const sketcherViewer = new ChemDoodle.ViewerCanvas(\n        \"sketcher-viewer-atto\",\n        100,\n        100\n      );\n      sketcherViewer.emptyMessage = \"No data loaded\";\n      sketcherViewer.styles.atoms_displayTerminalCarbonLabels_2D = true;\n      sketcherViewer.styles.atoms_useJMOLColors = true;\n      sketcherViewer.styles.bonds_clearOverlaps_2D = true;\n      sketcher.oldFunc = sketcher.checksOnAction;\n      sketcher.checksOnAction = function (force) {\n        this.oldFunc(force);\n        let mols = sketcher.molecules;\n        let forms = sketcher.shapes;\n        sketcherViewer.loadContent(mols, forms);\n        sketcher.center();\n        for (let i = 0, ii = this.molecules.length; i < ii; i++) {\n          this.molecules[i].check();\n        }\n      };\n    } catch (error) {\n      console.error(\"Error:\", error.message);\n    }\n  };\n\n  init = async () => {\n    try {\n      const modal = await Modal.create({\n        title: getString(\"sketchtitle\"),\n        show: true,\n        removeOnClose: true,\n      });\n      Templates.renderForPromise(\"tiny_chemdraw/chemTemplate\", {}).then(\n        async ({ html, js }) => {\n          Templates.appendNodeContents(modal.getBody(), html, js);\n          const resources = [\n            `${Config.wwwroot}/lib/editor/tiny/plugins/chemdraw/ChemDoodle/install/ChemDoodleWeb.css`,\n            `${Config.wwwroot}/lib/editor/tiny/plugins/chemdraw/ChemDoodle/install/uis/jquery-ui-1.11.4.css`,\n            `${Config.wwwroot}/lib/editor/tiny/plugins/chemdraw/ChemDoodle/install/ChemDoodleWeb.js`,\n            `${Config.wwwroot}/lib/editor/tiny/plugins/chemdraw/ChemDoodle/install/uis/ChemDoodleWeb-uis.js`,\n            `${Config.wwwroot}/lib/editor/tiny/plugins/chemdraw/chem/chem.css`,\n          ];\n\n          const types = [\n            \"stylesheet\",\n            \"stylesheet\",\n            \"script\",\n            \"script\",\n            \"stylesheet\",\n          ];\n\n          for (let i = 0; i < resources.length; i++) {\n            await this.loadResource(resources[i], types[i]);\n          }\n\n          // Add this line to fix the model width.\n          window.parent.document.querySelector(\".modal-dialog\").style.maxWidth =\n            \"850px\";\n\n          // Load and run ChemDoodle functionality\n          this.initializeChemDoodle();\n        }\n      );\n    } catch (error) {\n      displayException(error);\n    }\n  };\n};\n\nexport const insert = () => {\n  let src = ChemDoodle.io.png.string(sketcherViewer);\n  let mol = sketcherViewer.getMolecule();\n  let molFile = ChemDoodle.writeMOL(mol);\n\n\n  if (window.parent.tinyMCE && window.parent.tinyMCE.activeEditor) {\n\n    var content = '<img src=\"' + src + '\"';\n\n    window.parent.tinyMCE.activeEditor.execCommand(\"mceInsertContent\", 0, content);\n    window.parent.tinyMCE.activeEditor.execCommand(\"mceInsertContent\", 0, \"<!--\" + molFile + \"-->\" );\n    var modal = window.parent.document.querySelector(\".modal\");\n    var closeButton = modal.querySelector(\".close\");\n    closeButton.click();\n  }\n  console.log(\"button Click\");\n};\n"],"names":["editor","constructor","loadResource","async","url","type","Promise","resolve","reject","element","document","createElement","onload","onerror","Error","rel","href","src","appendChild","initializeChemDoodle","ChemDoodle","ELEMENT","jmolColor","sketcher","SketcherCanvas","useServices","requireStartingAtom","styles","atoms_displayTerminalCarbonLabels_2D","atoms_useJMOLColors","bonds_clearOverlaps_2D","shapes_color","repaint","sketcherViewer","ViewerCanvas","emptyMessage","oldFunc","checksOnAction","force","mols","molecules","forms","shapes","loadContent","center","i","ii","this","length","check","error","console","message","init","modal","Modal","create","title","show","removeOnClose","renderForPromise","then","html","js","appendNodeContents","getBody","resources","Config","wwwroot","types","window","parent","querySelector","style","maxWidth","io","png","string","mol","getMolecule","molFile","writeMOL","tinyMCE","activeEditor","content","execCommand","click","log"],"mappings":";;;;;;;sPA6ByB,MACvBA,OAAS,KACTC,YAAYD,aACLA,OAASA,OAGhBE,aAAeC,MAAOC,IAAKC,OAClB,IAAIC,SAAQ,CAACC,QAASC,gBACrBC,QACK,WAATJ,KACIK,SAASC,cAAc,UACvBD,SAASC,cAAc,QAC7BF,QAAQG,OAASL,QACjBE,QAAQI,QAAU,IAChBL,OAAO,IAAIM,MAAO,kBAAiBT,SAASD,QACjC,eAATC,MACFI,QAAQM,IAAM,aACdN,QAAQO,KAAOZ,KACG,WAATC,OACTI,QAAQQ,IAAMb,KAEhBM,SAAkB,WAATL,KAAoB,OAAS,QAAQa,YAAYT,YAI9DU,qBAAuB,SAEnBC,WAAWC,QAAX,EAAwBC,UAAY,QACpCF,WAAWC,QAAX,EAAwBC,UAAY,gBAG9BC,SAAW,IAAIH,WAAWI,eAAe,WAAY,IAAK,IAAK,CACnEC,aAAa,EACbC,qBAAqB,IAGvBH,SAASI,OAAOC,sCAAuC,EACvDL,SAASI,OAAOE,qBAAsB,EACtCN,SAASI,OAAOG,wBAAyB,EACzCP,SAASI,OAAOI,aAAe,UAC/BR,SAASS,gBAEHC,eAAiB,IAAIb,WAAWc,aACpC,uBACA,IACA,KAEFD,eAAeE,aAAe,iBAC9BF,eAAeN,OAAOC,sCAAuC,EAC7DK,eAAeN,OAAOE,qBAAsB,EAC5CI,eAAeN,OAAOG,wBAAyB,EAC/CP,SAASa,QAAUb,SAASc,eAC5Bd,SAASc,eAAiB,SAAUC,YAC7BF,QAAQE,WACTC,KAAOhB,SAASiB,UAChBC,MAAQlB,SAASmB,OACrBT,eAAeU,YAAYJ,KAAME,OACjClB,SAASqB,aACJ,IAAIC,EAAI,EAAGC,GAAKC,KAAKP,UAAUQ,OAAQH,EAAIC,GAAID,SAC7CL,UAAUK,GAAGI,SAGtB,MAAOC,OACPC,QAAQD,MAAM,SAAUA,MAAME,WAIlCC,KAAOlD,oBAEGmD,YAAcC,eAAMC,OAAO,CAC/BC,OAAO,mBAAU,eACjBC,MAAM,EACNC,eAAe,uBAEPC,iBAAiB,6BAA8B,IAAIC,MAC3D1D,MAAAA,WAAO2D,KAAEA,KAAFC,GAAQA,4BACHC,mBAAmBV,MAAMW,UAAWH,KAAMC,UAC9CG,UAAY,CACf,GAAEC,gBAAOC,gFACT,GAAED,gBAAOC,uFACT,GAAED,gBAAOC,+EACT,GAAED,gBAAOC,uFACT,GAAED,gBAAOC,0DAGNC,MAAQ,CACZ,aACA,aACA,SACA,SACA,kBAGG,IAAIxB,EAAI,EAAGA,EAAIqB,UAAUlB,OAAQH,UAC9BE,KAAK7C,aAAagE,UAAUrB,GAAIwB,MAAMxB,IAI9CyB,OAAOC,OAAO7D,SAAS8D,cAAc,iBAAiBC,MAAMC,SAC1D,aAGGvD,0BAGT,MAAO+B,mCACUA,0BAKD,SAChBjC,IAAMG,WAAWuD,GAAGC,IAAIC,OAAO5C,gBAC/B6C,IAAM7C,eAAe8C,cACrBC,QAAU5D,WAAW6D,SAASH,QAG9BR,OAAOC,OAAOW,SAAWZ,OAAOC,OAAOW,QAAQC,aAAc,KAE3DC,QAAU,aAAenE,IAAM,IAEnCqD,OAAOC,OAAOW,QAAQC,aAAaE,YAAY,mBAAoB,EAAGD,SACtEd,OAAOC,OAAOW,QAAQC,aAAaE,YAAY,mBAAoB,EAAG,UAASL,QAAU,UAC7EV,OAAOC,OAAO7D,SAAS8D,cAAc,UACzBA,cAAc,UAC1Bc,QAEdnC,QAAQoC,IAAI"}